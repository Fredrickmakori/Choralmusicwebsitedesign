import{c as L,j as e,m as Z,T as ee,n as se,p as te,X as ae,l as T,q as re,D as ie,t as oe,O as ne,r as c,v as le,w as ce,P as Y,x as H,y as de,z as ue,A as xe,I as z,E as he,B as F,F as me,H as pe,J as fe,K as ge,C as _,a as R,b as I,d as A,M as V,e as je,i as ve,f as be}from"./index-B9ED3BN7.js";import{D as ye,T as Ce,a as Ne,b as K,c as P,d as ke,e as D}from"./table-D_OvaKhC.js";import{L as C}from"./label-f1mC0lCR.js";import{u as Se,C as we,S as M,a as U,b as q,c as O,d as m}from"./select-D0b4JcHy.js";import{t as S,s as $}from"./supabase-B7Qy_EC5.js";import{C as Pe,T as De,E as Fe}from"./trending-up-D3VyGoPZ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],X=L("plus",Te);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ze=L("square-pen",Ee);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Re=L("trash-2",_e);function Ie({...t}){return e.jsx(Z,{"data-slot":"dialog",...t})}function Ae({...t}){return e.jsx(ee,{"data-slot":"dialog-trigger",...t})}function Me({...t}){return e.jsx(oe,{"data-slot":"dialog-portal",...t})}function Ue({className:t,...r}){return e.jsx(ne,{"data-slot":"dialog-overlay",className:T("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...r})}function qe({className:t,children:r,...i}){return e.jsxs(Me,{"data-slot":"dialog-portal",children:[e.jsx(Ue,{}),e.jsxs(se,{"data-slot":"dialog-content",className:T("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[r,e.jsxs(te,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(ae,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Oe({className:t,...r}){return e.jsx("div",{"data-slot":"dialog-header",className:T("flex flex-col gap-2 text-center sm:text-left",t),...r})}function $e({className:t,...r}){return e.jsx(re,{"data-slot":"dialog-title",className:T("text-lg leading-none font-semibold",t),...r})}function Le({className:t,...r}){return e.jsx(ie,{"data-slot":"dialog-description",className:T("text-muted-foreground text-sm",t),...r})}var B="Checkbox",[Be]=xe(B),[He,Ve]=Be(B),G=c.forwardRef((t,r)=>{const{__scopeCheckbox:i,name:h,checked:b,defaultChecked:o,required:y,disabled:p,value:g="on",onCheckedChange:n,form:l,...j}=t,[d,f]=c.useState(null),N=le(r,x=>f(x)),s=c.useRef(!1),a=d?l||!!d.closest("form"):!0,[u=!1,k]=ce({prop:b,defaultProp:o,onChange:n}),v=c.useRef(u);return c.useEffect(()=>{const x=d==null?void 0:d.form;if(x){const E=()=>k(v.current);return x.addEventListener("reset",E),()=>x.removeEventListener("reset",E)}},[d,k]),e.jsxs(He,{scope:i,state:u,disabled:p,children:[e.jsx(Y.button,{type:"button",role:"checkbox","aria-checked":w(u)?"mixed":u,"aria-required":y,"data-state":W(u),"data-disabled":p?"":void 0,disabled:p,value:g,...j,ref:N,onKeyDown:H(t.onKeyDown,x=>{x.key==="Enter"&&x.preventDefault()}),onClick:H(t.onClick,x=>{k(E=>w(E)?!0:!E),a&&(s.current=x.isPropagationStopped(),s.current||x.stopPropagation())})}),a&&e.jsx(Ke,{control:d,bubbles:!s.current,name:h,value:g,checked:u,required:y,disabled:p,form:l,style:{transform:"translateX(-100%)"},defaultChecked:w(o)?!1:o})]})});G.displayName=B;var Q="CheckboxIndicator",J=c.forwardRef((t,r)=>{const{__scopeCheckbox:i,forceMount:h,...b}=t,o=Ve(Q,i);return e.jsx(de,{present:h||w(o.state)||o.state===!0,children:e.jsx(Y.span,{"data-state":W(o.state),"data-disabled":o.disabled?"":void 0,...b,ref:r,style:{pointerEvents:"none",...t.style}})})});J.displayName=Q;var Ke=t=>{const{control:r,checked:i,bubbles:h=!0,defaultChecked:b,...o}=t,y=c.useRef(null),p=Se(i),g=ue(r);c.useEffect(()=>{const l=y.current,j=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(j,"checked").set;if(p!==i&&f){const N=new Event("click",{bubbles:h});l.indeterminate=w(i),f.call(l,w(i)?!1:i),l.dispatchEvent(N)}},[p,i,h]);const n=c.useRef(w(i)?!1:i);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:b??n.current,...o,tabIndex:-1,ref:y,style:{...t.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function w(t){return t==="indeterminate"}function W(t){return w(t)?"indeterminate":t?"checked":"unchecked"}var Xe=G,Ye=J;function Ge({className:t,...r}){return e.jsx(Xe,{"data-slot":"checkbox",className:T("peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(Ye,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(we,{className:"size-3.5"})})})}function Qe({onClose:t}){const[r,i]=c.useState({title:"",price:"",description:"",difficulty:"",duration:"",language:"",accompaniment:"",voiceParts:[]}),[h,b]=c.useState(null),[o,y]=c.useState(0),[p,g]=c.useState(!1),[n,l]=c.useState(!1),j=["Soprano","Alto","Tenor","Bass","Soprano I","Soprano II"],d=s=>{i(a=>({...a,voiceParts:a.voiceParts.includes(s)?a.voiceParts.filter(u=>u!==s):[...a.voiceParts,s]}))},f=s=>{var u;const a=(u=s.target.files)==null?void 0:u[0];a&&a.type==="application/pdf"?(b(a),S.success("PDF file selected successfully")):S.error("Please select a valid PDF file")},N=async s=>{s.preventDefault(),g(!0);try{let a="";if(h){const u=me(pe,`compositions/${Date.now()}_${h.name}`),k=fe(u,h);k.on("state_changed",v=>{const x=v.bytesTransferred/v.totalBytes*100;y(x)},v=>{console.error("Upload error:",v),S.error("Failed to upload PDF file"),g(!1)},async()=>{a=await ge(k.snapshot.ref),console.log("Composition data:",{...r,pdfUrl:a}),S.success("Composition uploaded successfully!"),l(!0),setTimeout(()=>{t()},1500)})}else setTimeout(()=>{g(!1),l(!0),setTimeout(()=>{t()},1500)},1500)}catch(a){console.error("Error uploading composition:",a),S.error("Failed to upload composition"),g(!1)}};return n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Pe,{className:"size-16 text-green-600 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Upload Successful!"}),e.jsx("p",{className:"text-gray-600",children:"Your composition has been added to the marketplace."})]}):e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"title",children:"Composition Title *"}),e.jsx(z,{id:"title",value:r.title,onChange:s=>i(a=>({...a,title:s.target.value})),placeholder:"e.g., Ave Maria",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"description",children:"Description *"}),e.jsx(he,{id:"description",value:r.description,onChange:s=>i(a=>({...a,description:s.target.value})),placeholder:"Describe your composition, its mood, suitable occasions...",rows:4,required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"price",children:"Price (USD) *"}),e.jsx(z,{id:"price",type:"number",step:"0.01",min:"0",value:r.price,onChange:s=>i(a=>({...a,price:s.target.value})),placeholder:"29.99",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Voice Parts *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{id:`voice-${s}`,checked:r.voiceParts.includes(s),onCheckedChange:()=>d(s)}),e.jsx("label",{htmlFor:`voice-${s}`,className:"text-sm cursor-pointer",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"difficulty",children:"Difficulty Level *"}),e.jsxs(M,{value:r.difficulty,onValueChange:s=>i(a=>({...a,difficulty:s})),required:!0,children:[e.jsx(U,{children:e.jsx(q,{placeholder:"Select difficulty"})}),e.jsxs(O,{children:[e.jsx(m,{value:"Easy",children:"Easy"}),e.jsx(m,{value:"Intermediate",children:"Intermediate"}),e.jsx(m,{value:"Advanced",children:"Advanced"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"duration",children:"Duration *"}),e.jsx(z,{id:"duration",value:r.duration,onChange:s=>i(a=>({...a,duration:s.target.value})),placeholder:"e.g., 4:30",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"language",children:"Language *"}),e.jsxs(M,{value:r.language,onValueChange:s=>i(a=>({...a,language:s})),required:!0,children:[e.jsx(U,{children:e.jsx(q,{placeholder:"Select language"})}),e.jsxs(O,{children:[e.jsx(m,{value:"English",children:"English"}),e.jsx(m,{value:"Latin",children:"Latin"}),e.jsx(m,{value:"German",children:"German"}),e.jsx(m,{value:"French",children:"French"}),e.jsx(m,{value:"Italian",children:"Italian"}),e.jsx(m,{value:"Spanish",children:"Spanish"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"accompaniment",children:"Accompaniment *"}),e.jsxs(M,{value:r.accompaniment,onValueChange:s=>i(a=>({...a,accompaniment:s})),required:!0,children:[e.jsx(U,{children:e.jsx(q,{placeholder:"Select accompaniment"})}),e.jsxs(O,{children:[e.jsx(m,{value:"A cappella",children:"A cappella"}),e.jsx(m,{value:"Piano",children:"Piano"}),e.jsx(m,{value:"Organ",children:"Organ"}),e.jsx(m,{value:"String Quartet",children:"String Quartet"}),e.jsx(m,{value:"Orchestra",children:"Orchestra"})]})]})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"file",children:["PDF Score ",o>0&&o<100&&`(${Math.round(o)}%)`]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(z,{id:"file",type:"file",accept:"application/pdf",onChange:f,className:"cursor-pointer"}),h&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",h.name]}),o>0&&o<100&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${o}%`}})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:t,className:"flex-1",disabled:p,children:"Cancel"}),e.jsx(F,{type:"submit",disabled:p,className:"flex-1",children:p?"Uploading...":"Upload Composition"})]})]})}function as({currentUser:t}){const[r,i]=c.useState(!1),[h,b]=c.useState({composerCompositions:[],totalRevenue:0,totalSales:0,loading:!0});c.useEffect(()=>{(async()=>{try{const l=be.currentUser;if(!l){S.error("Not authenticated");return}const{data:j,error:d}=await $.from("composers").select("id").eq("user_id",l.uid).single();if(d||!j){S.error("Composer profile not found"),b(v=>({...v,loading:!1}));return}const{data:f,error:N}=await $.from("compositions").select(`
            id,
            title,
            description,
            price,
            created_at,
            is_published,
            composition_stats(views, purchases)
          `).eq("composer_id",j.id).eq("deleted",!1);if(N)throw N;const{data:s,error:a}=await $.from("purchases").select("price_paid").in("composition_id",(f==null?void 0:f.map(v=>v.id))||[]).eq("is_active",!0);if(a)throw a;const u=(s==null?void 0:s.reduce((v,x)=>v+(x.price_paid||0),0))||0,k=(s==null?void 0:s.length)||0;b({composerCompositions:f||[],totalRevenue:u,totalSales:k,loading:!1})}catch(l){console.error("Error fetching composer data:",l),S.error("Failed to load dashboard"),b(j=>({...j,loading:!1}))}})()},[]);const{composerCompositions:o,totalRevenue:y,totalSales:p}=h,g=o.map(n=>{const l=mockPurchases.filter(d=>d.compositionId===n.id),j=l.reduce((d,f)=>d+f.price,0);return{...n,salesCount:l.length,revenue:j}});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Composer Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Manage your compositions and track your sales"})]}),e.jsxs(Ie,{open:r,onOpenChange:i,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(F,{size:"lg",children:[e.jsx(X,{className:"size-5 mr-2"}),"Upload New Composition"]})}),e.jsxs(qe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsx($e,{children:"Upload New Composition"}),e.jsx(Le,{children:"Add a new choral composition to the marketplace"})]}),e.jsx(Qe,{onClose:()=>i(!1)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(_,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx(ye,{className:"size-5 text-green-600"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",y.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["From ",p," sales"]})]})]}),e.jsxs(_,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-gray-600",children:"Published Works"}),e.jsx(V,{className:"size-5 text-blue-600"})]}),e.jsxs(A,{children:[e.jsx("div",{className:"text-3xl font-bold",children:o.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Active compositions"})]})]}),e.jsxs(_,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-gray-600",children:"Avg Price"}),e.jsx(De,{className:"size-5 text-purple-600"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",o.length>0?(o.reduce((n,l)=>n+l.price,0)/o.length).toFixed(2):"0.00"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Average listing price"})]})]})]}),e.jsxs(_,{children:[e.jsxs(R,{children:[e.jsx(I,{children:"My Compositions"}),e.jsx(je,{children:"Manage and track performance of your published works"})]}),e.jsx(A,{children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"size-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You haven't uploaded any compositions yet."}),e.jsxs(F,{onClick:()=>i(!0),children:[e.jsx(X,{className:"size-4 mr-2"}),"Upload Your First Composition"]})]}):e.jsxs(Ce,{children:[e.jsx(Ne,{children:e.jsxs(K,{children:[e.jsx(P,{children:"Title"}),e.jsx(P,{children:"Difficulty"}),e.jsx(P,{children:"Price"}),e.jsx(P,{className:"text-right",children:"Sales"}),e.jsx(P,{className:"text-right",children:"Revenue"}),e.jsx(P,{children:"Date Added"}),e.jsx(P,{className:"text-right",children:"Actions"})]})}),e.jsx(ke,{children:g.map(n=>e.jsxs(K,{children:[e.jsx(D,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.title}),e.jsx("p",{className:"text-sm text-gray-500",children:n.voiceParts.join(", ")})]})}),e.jsx(D,{children:e.jsx(ve,{variant:"outline",children:n.difficulty})}),e.jsxs(D,{children:["$",n.price.toFixed(2)]}),e.jsx(D,{className:"text-right",children:n.salesCount}),e.jsxs(D,{className:"text-right font-medium",children:["$",n.revenue.toFixed(2)]}),e.jsx(D,{children:new Date(n.dateAdded).toLocaleDateString()}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(Fe,{className:"size-4"})}),e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(ze,{className:"size-4"})}),e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(Re,{className:"size-4 text-red-600"})})]})})]},n.id))})]})})]})]})}export{as as ComposerDashboard};
