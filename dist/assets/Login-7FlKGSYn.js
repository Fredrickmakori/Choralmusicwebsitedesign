import{c as F,R as x,r as v,u as L,o as O,j as e,M as R,C as D,a as G,b as M,e as U,d as B,I as E,B as P,f as N,g as T,s as q,G as H,h as V}from"./index-B9ED3BN7.js";import{L as S}from"./label-f1mC0lCR.js";import{S as W,a as $,b as Y,c as J,d as _}from"./select-D0b4JcHy.js";import{s as g,t as u}from"./supabase-B7Qy_EC5.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]],Q=F("log-in",K);var k={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},I=x.createContext&&x.createContext(k),f=function(){return f=Object.assign||function(r){for(var s,t=1,a=arguments.length;t<a;t++){s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},f.apply(this,arguments)},X=function(r,s){var t={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&s.indexOf(a)<0&&(t[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(r);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(r,a[n])&&(t[a[n]]=r[a[n]]);return t};function A(r){return r&&r.map(function(s,t){return x.createElement(s.tag,f({key:t},s.attr),A(s.child))})}function Z(r){return function(s){return x.createElement(ee,f({attr:f({},r.attr)},s),A(r.child))}}function ee(r){var s=function(t){var a=r.attr,n=r.size,d=r.title,c=X(r,["attr","size","title"]),m=n||t.size||"1em",l;return t.className&&(l=t.className),r.className&&(l=(l?l+" ":"")+r.className),x.createElement("svg",f({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:l,style:f(f({color:r.color||t.color},t.style),r.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),d&&x.createElement("title",null,d),r.children)};return I!==void 0?x.createElement(I.Consumer,null,function(t){return s(t)}):s(k)}function re(r){return Z({attr:{version:"1.1",x:"0px",y:"0px",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FFC107",d:`M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\r
	c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24\r
	c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z`}},{tag:"path",attr:{fill:"#FF3D00",d:`M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657\r
	C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z`}},{tag:"path",attr:{fill:"#4CAF50",d:`M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\r
	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z`}},{tag:"path",attr:{fill:"#1976D2",d:`M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\r
	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z`}}]})(r)}const j={async syncUser(r,s){try{const t=await r.getIdToken(),{data:a,error:n}=await g.from("users").select("*, user_roles(role_id, roles(name))").eq("firebase_uid",r.uid).single();if(n&&n.code!=="PGRST116")throw n;let d;if(a)d=a.id;else{const{data:l,error:p}=await g.from("users").insert({firebase_uid:r.uid,email:r.email,display_name:r.displayName,phone:r.phoneNumber,avatar_url:r.photoURL}).select().single();if(p)throw p;d=l.id;const{data:y,error:w}=await g.from("roles").select("id").eq("name",s).single();if(w)throw w;const{error:b}=await g.from("user_roles").insert({user_id:d,role_id:y.id});if(b)throw b;s==="buyer"?await g.from("buyers").insert({user_id:d}):s==="composer"&&await g.from("composers").insert({user_id:d})}const{data:c,error:m}=await g.from("users").select(`
          *,
          user_roles(
            role_id,
            roles(name)
          )
        `).eq("id",d).single();if(m)throw m;return{id:c.id,firebaseUid:c.firebase_uid,email:c.email,displayName:c.display_name,roles:c.user_roles.map(l=>l.roles.name)}}catch(t){throw console.error("Error syncing user:",t),t}},async logAudit(r,s,t){try{await g.from("audit_logs").insert({user_id:r,action:s,payload:t})}catch(a){console.error("Error logging audit:",a)}}};function ie(){const[r,s]=v.useState(""),[t,a]=v.useState(""),[n,d]=v.useState("buyer"),[c,m]=v.useState(!1),[l,p]=v.useState(!1),y=L(),w=(o,i)=>{y(o==="buyer"?`/buyer?uid=${i}`:o==="composer"?`/composer?uid=${i}`:o==="admin"?`/admin?uid=${i}`:"/")};v.useEffect(()=>{const o=O(N,async i=>{if(i)try{const h=await j.getUserRole(i.uid);w(h,i.uid)}catch(h){console.error("Failed to fetch user role:",h)}});return()=>o()},[]);const b=async o=>{if(o.preventDefault(),!r||!t)return u.error("Please enter email and password");if(t.length<6)return u.error("Password must be at least 6 characters");m(!0);try{let i;if(l)i=(await T(N,r,t)).user,await j.syncUser(i,n),u.success("Account created successfully!");else{i=(await q(N,r,t)).user;const C=await j.getUserRole(i.uid);u.success("Logged in successfully!"),d(C)}w(n,i.uid)}catch(i){switch(console.error("Authentication error:",i),i.code){case"auth/user-not-found":u.error("No account found with this email. Please sign up."),p(!0);break;case"auth/wrong-password":u.error("Incorrect password. Please try again.");break;case"auth/email-already-in-use":u.error("This email is already registered. Please sign in instead."),p(!1);break;case"auth/weak-password":u.error("Password is too weak. Please use at least 6 characters.");break;case"auth/invalid-email":u.error("Invalid email address format.");break;default:u.error(i.message||"Authentication failed. Please try again.")}}finally{m(!1)}},z=async()=>{m(!0);const o=new H;try{const h=(await V(N,o)).user,C=await j.getUserRole(h.uid)||n;await j.syncUser(h,C),u.success("Logged in with Google successfully!"),w(C,h.uid)}catch(i){console.error("Google sign-in error:",i),u.error(i.message||"Google sign-in failed")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-8 items-center",children:[e.jsx("div",{className:"text-center lg:text-left space-y-6",children:e.jsxs("div",{className:"flex items-center justify-center lg:justify-start gap-3",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 p-4 rounded-2xl",children:e.jsx(R,{className:"size-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Prime Media"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Choral Music Marketplace"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{className:"shadow-xl",children:[e.jsxs(G,{children:[e.jsx(M,{className:"text-2xl",children:l?"Create Account":"Sign In"}),e.jsx(U,{children:l?"Create a new account to get started":"Enter your credentials to access your account"})]}),e.jsxs(B,{children:[e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"role",children:l?"Select Your Role":"Login As"}),e.jsxs(W,{value:n,onValueChange:o=>d(o),children:[e.jsx($,{children:e.jsx(Y,{})}),e.jsxs(J,{children:[e.jsx(_,{value:"buyer",children:"Buyer"}),e.jsx(_,{value:"composer",children:"Composer"}),e.jsx(_,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(E,{id:"email",type:"email",placeholder:"you@example.com",value:r,onChange:o=>s(o.target.value),required:!0,disabled:c})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"password",children:"Password"}),e.jsx(E,{id:"password",type:"password",placeholder:l?"At least 6 characters":"Enter your password",value:t,onChange:o=>a(o.target.value),required:!0,disabled:c,minLength:6})]}),e.jsxs(P,{type:"submit",className:"w-full",size:"lg",disabled:c,children:[e.jsx(Q,{className:"size-5 mr-2"}),c?"Processing...":l?"Create Account":"Sign In"]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(P,{type:"button",className:"w-full flex items-center justify-center gap-2",variant:"outline",onClick:z,disabled:c,children:[e.jsx(re,{className:"size-5"}),"Sign in with Google"]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>p(!l),className:"text-sm text-blue-600 hover:underline",disabled:c,children:l?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})]}),e.jsx("p",{className:"text-center text-sm text-gray-500",children:l?e.jsxs(e.Fragment,{children:["By creating an account, you agree to our"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:underline font-medium",children:"Terms of Service"})]}):e.jsxs(e.Fragment,{children:["Need help?"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:underline font-medium",children:"Contact Support"})]})})]})]})})}export{ie as Login};
