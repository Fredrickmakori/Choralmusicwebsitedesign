import{c as b,r as d,j as e,P as B,l as q,C as c,a as l,b as n,M as v,d as o,e as P,B as w,f as H}from"./index-B9ED3BN7.js";import{D as Y,T as V,a as Z,b as M,c as u,d as G,e as p}from"./table-D_OvaKhC.js";import{T as J,a as K,b as _,c as D}from"./tabs-BvwTvpYE.js";import{t as C,s as $}from"./supabase-B7Qy_EC5.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],W=b("calendar",Q);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ee=b("credit-card",X);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],ae=b("download",se);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],E=b("shopping-bag",te);var re="Separator",F="horizontal",ie=["horizontal","vertical"],A=d.forwardRef((r,a)=>{const{decorative:x,orientation:i=F,...y}=r,N=ce(i)?i:F,m=x?{role:"none"}:{"aria-orientation":N==="vertical"?N:void 0,role:"separator"};return e.jsx(B.div,{"data-orientation":N,...m,...y,ref:a})});A.displayName=re;function ce(r){return ie.includes(r)}var le=A;function ne({className:r,orientation:a="horizontal",decorative:x=!0,...i}){return e.jsx(le,{"data-slot":"separator-root",decorative:x,orientation:a,className:q("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",r),...i})}function me({currentUser:r,cart:a,onClearCart:x}){const[i,y]=d.useState("library"),[N,h]=d.useState(!0),[m,k]=d.useState([]),[L,T]=d.useState(0);d.useEffect(()=>{(async()=>{try{h(!0);const t=H.currentUser;if(!t){C.error("You must be signed in to view purchases"),h(!1);return}const{data:g}=await $.from("users").select("id").eq("firebase_uid",t.uid).single();if(!g){k([]),T(0),h(!1);return}const{data:f,error:z}=await $.from("purchases").select("*, compositions(*)").eq("buyer_id",g.id).eq("is_active",!0).order("purchased_at",{ascending:!1});if(z)throw z;const R=(f||[]).map(j=>({...j,composition:j.compositions||j.composition||null}));k(R);const I=(f||[]).reduce((j,U)=>j+(U.price_paid||0),0);T(I)}catch(t){console.error("Error loading purchases:",t),C.error("Failed to load purchases")}finally{h(!1)}})()},[]);const S=a.reduce((s,t)=>s+t.composition.price*t.quantity,0),O=()=>{C.success("Purchase successful! Your compositions are now in your library."),x(),y("library")};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Access your purchased music and manage your account"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-600",children:"My Library"}),e.jsx(v,{className:"size-5 text-blue-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold",children:m.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Compositions owned"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-600",children:"Total Spent"}),e.jsx(Y,{className:"size-5 text-green-600"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",L.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All-time purchases"})]})]}),e.jsxs(c,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(n,{className:"text-sm font-medium text-gray-600",children:"Cart Items"}),e.jsx(E,{className:"size-5 text-purple-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold",children:a.length}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ready to checkout"})]})]})]}),e.jsxs(J,{value:i,onValueChange:y,children:[e.jsxs(K,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsx(_,{value:"library",children:"My Library"}),e.jsx(_,{value:"checkout",children:"Checkout"})]}),e.jsx(D,{value:"library",className:"mt-6",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Purchased Compositions"}),e.jsx(P,{children:"Download and access your purchased music anytime"})]}),e.jsx(o,{children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"size-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You haven't purchased any compositions yet."}),e.jsx(w,{onClick:()=>window.location.reload(),children:"Browse Marketplace"})]}):e.jsxs(V,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(u,{children:"Composition"}),e.jsx(u,{children:"Composer"}),e.jsx(u,{children:"Purchase Date"}),e.jsx(u,{children:"Price"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(G,{children:m.map(({composition:s,purchaseDate:t,price:g,id:f})=>e.jsxs(M,{children:[e.jsx(p,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s==null?void 0:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s==null?void 0:s.voiceParts.join(", ")})]})}),e.jsx(p,{children:s==null?void 0:s.composerName}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"size-4 text-gray-400"}),new Date(t).toLocaleDateString()]})}),e.jsxs(p,{children:["$",g.toFixed(2)]}),e.jsx(p,{className:"text-right",children:e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"size-4 mr-2"}),"Download PDF"]})})]},f))})]})})]})}),e.jsx(D,{value:"checkout",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Shopping Cart"}),e.jsx(P,{children:"Review your items before checkout"})]}),e.jsx(o,{children:a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"size-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Your cart is empty"})]}):e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg",children:[e.jsx(v,{className:"size-10 text-blue-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.composition.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.composition.composerName}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.composition.voiceParts.join(", ")," • ",s.composition.difficulty]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-lg",children:["$",s.composition.price.toFixed(2)]})})]},s.composition.id))})})]})}),e.jsx("div",{children:e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(n,{children:"Order Summary"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{children:["$",S.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Processing Fee"}),e.jsx("span",{children:"$0.00"})]}),e.jsx(ne,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",S.toFixed(2)]})]})]}),e.jsxs(w,{className:"w-full",size:"lg",disabled:a.length===0,onClick:O,children:[e.jsx(ee,{className:"size-5 mr-2"}),"Complete Purchase"]}),e.jsx("div",{className:"text-xs text-gray-500 text-center mt-4",children:"Secure checkout • Instant download • Lifetime access"})]})]})})]})})]})]})}export{me as BuyerDashboard};
