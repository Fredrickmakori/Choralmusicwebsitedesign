import{c as I,r as l,j as e,C as o,a as d,b as x,d as h,M as ie,e as f,i as k,aa as z,ab as E,B as U,ac as M,ad as R,ae as T,af as L}from"./index-B9ED3BN7.js";import{D as ae,T as g,a as N,b as n,c as t,d as y,e as r}from"./table-D_OvaKhC.js";import{T as ce,a as le,b as C,c as D}from"./tabs-BvwTvpYE.js";import{s as m,t as ne}from"./supabase-B7Qy_EC5.js";import{U as oe}from"./users-BfyAmKSd.js";import{T as de,C as xe,E as B}from"./trending-up-D3VyGoPZ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],F=I("ban",he);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],P=I("ellipsis-vertical",me);function be(){const[$,H]=l.useState("overview"),[je,_]=l.useState(!0),[V,q]=l.useState(0),[O,G]=l.useState(0),[J,K]=l.useState(0),[Q,W]=l.useState(0);l.useEffect(()=>{(async()=>{try{_(!0);const{count:i,error:a}=await m.from("users").select("id",{count:"exact",head:!0});if(a)throw a;q(i||0);const{count:c,error:u}=await m.from("compositions").select("id",{count:"exact",head:!0});if(u)throw u;G(c||0);const{data:p,error:b}=await m.from("purchases").select("price_paid",{count:"exact"});if(b)throw b;const v=(p||[]).reduce((j,w)=>j+(w.price_paid||0),0);K(v),W((p||[]).length)}catch(i){console.error("Failed to load admin stats:",i),ne.error("Failed to load admin stats")}finally{_(!1)}})()},[]);const[X,Y]=l.useState([]),[Z,ee]=l.useState([]);return l.useEffect(()=>{(async()=>{var i,a;try{const{data:c,error:u}=await m.from("composers").select("id, user_id, users(display_name, email)");if(u)throw u;const p=[];for(const j of c||[]){const{data:w}=await m.from("compositions").select("id").eq("composer_id",j.id).eq("deleted",!1),se=(w||[]).map(S=>S.id),{data:A}=await m.from("purchases").select("price_paid").in("composition_id",se||[]).eq("is_active",!0),te=(A||[]).reduce((S,re)=>S+(re.price_paid||0),0);p.push({id:j.id,display_name:((i=j.users)==null?void 0:i.display_name)||((a=j.users)==null?void 0:a.email)||"Unknown",compositionCount:(w||[]).length,salesCount:(A||[]).length,revenue:te})}Y(p);const{data:b,error:v}=await m.from("purchases").select("*, compositions(*), buyers(*)").order("purchased_at",{ascending:!1}).limit(10);if(v)throw v;ee(b||[])}catch(c){console.error("Failed to load composer stats or transactions:",c)}})()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600",children:"Manage platform operations and monitor activity"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(o,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx(oe,{className:"size-5 text-blue-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold",children:V}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[mockUsers.filter(s=>s.role==="composer").length," composers,"," ",mockUsers.filter(s=>s.role==="buyer").length," buyers"]})]})]}),e.jsxs(o,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Total Compositions"}),e.jsx(ie,{className:"size-5 text-purple-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold",children:O}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Published works"})]})]}),e.jsxs(o,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx(ae,{className:"size-5 text-green-600"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:["$",J.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Platform earnings"})]})]}),e.jsxs(o,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Transactions"}),e.jsx(de,{className:"size-5 text-orange-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-3xl font-bold",children:Q}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total sales"})]})]})]}),e.jsxs(ce,{value:$,onValueChange:H,children:[e.jsxs(le,{className:"grid w-full max-w-2xl grid-cols-4",children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"users",children:"Users"}),e.jsx(C,{value:"compositions",children:"Compositions"}),e.jsx(C,{value:"transactions",children:"Transactions"})]}),e.jsxs(D,{value:"overview",className:"mt-6 space-y-6",children:[e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"Top Composers"}),e.jsx(f,{children:"Highest earning composers on the platform"})]}),e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(n,{children:[e.jsx(t,{children:"Composer"}),e.jsx(t,{children:"Email"}),e.jsx(t,{className:"text-right",children:"Compositions"}),e.jsx(t,{className:"text-right",children:"Sales"}),e.jsx(t,{className:"text-right",children:"Revenue"})]})}),e.jsx(y,{children:X.sort((s,i)=>i.revenue-s.revenue).slice(0,5).map(s=>e.jsxs(n,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsx(r,{className:"text-gray-600",children:s.email}),e.jsx(r,{className:"text-right",children:s.compositionCount}),e.jsx(r,{className:"text-right",children:s.salesCount}),e.jsxs(r,{className:"text-right font-semibold",children:["$",s.revenue.toFixed(2)]})]},s.id))})]})})]}),e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"Recent Transactions"}),e.jsx(f,{children:"Latest purchases on the platform"})]}),e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(n,{children:[e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Buyer"}),e.jsx(t,{children:"Composition"}),e.jsx(t,{className:"text-right",children:"Amount"})]})}),e.jsx(y,{children:Z.map(s=>{var i,a,c;return e.jsxs(n,{children:[e.jsx(r,{children:new Date(s.purchaseDate).toLocaleDateString()}),e.jsx(r,{children:(i=s.buyer)==null?void 0:i.name}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(a=s.composition)==null?void 0:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["by ",(c=s.composition)==null?void 0:c.composerName]})]})}),e.jsxs(r,{className:"text-right font-semibold",children:["$",s.price.toFixed(2)]})]},s.id)})})]})})]})]}),e.jsx(D,{value:"users",className:"mt-6",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"All Users"}),e.jsx(f,{children:"Manage platform users and their roles"})]}),e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(n,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(y,{children:mockUsers.map(s=>e.jsxs(n,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsx(r,{children:s.email}),e.jsx(r,{children:e.jsx(k,{variant:"outline",className:"capitalize",children:s.role})}),e.jsx(r,{children:e.jsxs(k,{className:"bg-green-100 text-green-800",children:[e.jsx(xe,{className:"size-3 mr-1"}),"Active"]})}),e.jsx(r,{className:"text-right",children:e.jsxs(z,{children:[e.jsx(E,{asChild:!0,children:e.jsx(U,{variant:"ghost",size:"icon",children:e.jsx(P,{className:"size-4"})})}),e.jsxs(M,{align:"end",children:[e.jsx(R,{children:"Actions"}),e.jsxs(T,{children:[e.jsx(B,{className:"size-4 mr-2"}),"View Profile"]}),e.jsx(L,{}),e.jsxs(T,{className:"text-red-600",children:[e.jsx(F,{className:"size-4 mr-2"}),"Suspend User"]})]})]})})]},s.id))})]})})]})}),e.jsx(D,{value:"compositions",className:"mt-6",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"All Compositions"}),e.jsx(f,{children:"Manage and moderate published compositions"})]}),e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(n,{children:[e.jsx(t,{children:"Title"}),e.jsx(t,{children:"Composer"}),e.jsx(t,{children:"Difficulty"}),e.jsx(t,{children:"Price"}),e.jsx(t,{children:"Date Added"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(y,{children:mockCompositions.map(s=>e.jsxs(n,{children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-gray-500",children:s.voiceParts.join(", ")})]})}),e.jsx(r,{children:s.composerName}),e.jsx(r,{children:e.jsx(k,{variant:"outline",children:s.difficulty})}),e.jsxs(r,{children:["$",s.price.toFixed(2)]}),e.jsx(r,{children:new Date(s.dateAdded).toLocaleDateString()}),e.jsx(r,{className:"text-right",children:e.jsxs(z,{children:[e.jsx(E,{asChild:!0,children:e.jsx(U,{variant:"ghost",size:"icon",children:e.jsx(P,{className:"size-4"})})}),e.jsxs(M,{align:"end",children:[e.jsx(R,{children:"Actions"}),e.jsxs(T,{children:[e.jsx(B,{className:"size-4 mr-2"}),"View Details"]}),e.jsx(L,{}),e.jsxs(T,{className:"text-red-600",children:[e.jsx(F,{className:"size-4 mr-2"}),"Remove Listing"]})]})]})})]},s.id))})]})})]})}),e.jsx(D,{value:"transactions",className:"mt-6",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(x,{children:"All Transactions"}),e.jsx(f,{children:"Complete transaction history"})]}),e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(n,{children:[e.jsx(t,{children:"Transaction ID"}),e.jsx(t,{children:"Date"}),e.jsx(t,{children:"Buyer"}),e.jsx(t,{children:"Composition"}),e.jsx(t,{children:"Composer"}),e.jsx(t,{className:"text-right",children:"Amount"})]})}),e.jsx(y,{children:mockPurchases.sort((s,i)=>new Date(i.purchaseDate).getTime()-new Date(s.purchaseDate).getTime()).map(s=>{const i=mockCompositions.find(c=>c.id===s.compositionId),a=mockUsers.find(c=>c.id===s.buyerId);return e.jsxs(n,{children:[e.jsx(r,{className:"font-mono text-sm",children:s.id}),e.jsx(r,{children:new Date(s.purchaseDate).toLocaleDateString()}),e.jsx(r,{children:a==null?void 0:a.name}),e.jsx(r,{className:"font-medium",children:i==null?void 0:i.title}),e.jsx(r,{children:i==null?void 0:i.composerName}),e.jsxs(r,{className:"text-right font-semibold",children:["$",s.price.toFixed(2)]})]},s.id)})})]})})]})})]})]})}export{be as AdminPanel};
